"use strict";
class Table {
    constructor() {
        this.x = [];
        this.y = [];
        this.data = [
            { x: "Col1", y: "Row1", value: true },
            { x: "Col2", y: "Row3", value: true }
        ];
    }
    /* Step 1 */
    setWrapper(wrap) {
        return (this.wrapper = wrap);
    }
    /* Step 2 */
    draw() {
        if (!this.wrapper) {
            console.log("Error! No wrapper!");
            return;
        }
        this.wrapper.innerHTML = "";
        /* Step 3 */
        let tableDom = this.buildTableDom();
        this.wrapper.append(tableDom);
        this.initEvents();
        this.loggingData();
    }
    /* Step 3 */
    buildTableDom() {
        let tableDom = document.createElement("table");
        tableDom.classList.add("table");
        let tableHeaders = this.buildTableHeaders(); /* Step 4 */
        tableDom.append(tableHeaders);
        let tableBody = this.buildTableBody(); /* Step 5 */
        tableDom.append(tableBody);
        return tableDom;
    }
    /* Step 4 */
    buildTableHeaders() {
        let tableHead = document.createElement("thead");
        let tableHeadRow = document.createElement("tr");
        let emptyCell = document.createElement("th");
        tableHeadRow.append(emptyCell);
        for (let thName of this.x) {
            let headCell = document.createElement("th");
            headCell.innerHTML = thName;
            tableHeadRow.append(headCell);
        }
        tableHead.append(tableHeadRow);
        return tableHead;
    }
    /* Step 5 */
    buildTableBody() {
        let tableBodyDom = document.createElement("tbody");
        for (let i in this.y) {
            let y = +i;
            let tableBodyRow = this.buildTableBodyRow(y); /* Step 6 */
            tableBodyDom.append(tableBodyRow);
        }
        return tableBodyDom;
    }
    /* Step 6 */
    buildTableBodyRow(rowIndex) {
        let rowDom = document.createElement("tr");
        let rowName = this.y[rowIndex];
        let rowNameCell = document.createElement("td");
        rowNameCell.innerHTML = rowName;
        rowDom.append(rowNameCell);
        for (let i in this.x) {
            let y = +i;
            let tableCellDom = this.buildTableCellDom(y, rowIndex); /* Step 7 */
            rowDom.append(tableCellDom);
        }
        return rowDom;
    }
    /* Step 7 */
    buildTableCellDom(colIndex, rowIndex) {
        let cellDom = document.createElement("td");
        let rowName = this.y[rowIndex];
        let colName = this.x[colIndex];
        let cellValue = false;
        let dataPair = this.data.filter(function (obj) {
            return obj.x == colName && obj.y == rowName;
        });
        if (dataPair.length > 0 && dataPair[0].value) {
            cellValue = true;
        }
        let checkBox = document.createElement("input");
        checkBox.setAttribute("type", "checkbox");
        if (cellValue) {
            checkBox.setAttribute("checked", "checked");
        }
        let checkBoxData = { colIndex: colIndex, rowIndex: rowIndex };
        checkBox.dataset.position = JSON.stringify(checkBoxData);
        cellDom.append(checkBox);
        return cellDom;
    }
    /* Step 8 */
    initEvents() {
        if (this.wrapper) {
            this.wrapper.addEventListener("change", event => {
                if (!event.target) {
                    return;
                }
                let checkBox = event.target;
                const checkBoxData = checkBox.dataset.position;
                /* Step 9 */
                if (!checkBoxData) {
                    return;
                }
                const data = JSON.parse(checkBoxData) || {
                    colIndex: -1,
                    rowIndex: -1
                };
                let value = checkBox.checked;
                this.addDataPairByIndex(data.rowIndex, data.colIndex, value);
                // this.draw();
            });
        }
    }
    /* Step 9 */
    addDataPairByIndex(rowIndex, colIndex, value) {
        let colName = this.x[colIndex];
        let rowName = this.y[rowIndex];
        let dataPair = { x: colName, y: rowName, value: value };
        this.addDataPair(dataPair);
    }
    /* Step 10 */
    addDataPair(dataPair) {
        let index = null;
        for (let i in this.data) {
            if (this.data[i].x == dataPair.x && this.data[i].y == dataPair.y) {
                index = parseInt(i);
            }
        }
        if (index !== null) {
            this.data[index] = dataPair;
        }
        else {
            this.data.push(dataPair);
        }
    }
    /* Step 11 */
    addRow(rowName) {
        this.y.push(rowName);
    }
    addCol(colName) {
        this.x.push(colName);
    }
    /* Step 12 (For console log data) */
    loggingData() {
        console.log("Data logging: ");
        // console.log("---------------------------------------");
        // console.log("Array x");
        // console.log(this.x);
        // console.log("---------------------------------------");
        // console.log("Array y");
        // console.log(this.y);
        // console.log("---------------------------------------");
        console.log("Array data");
        console.log(this.data);
        console.log("#######################################");
    }
}
const initDomState = () => {
    let test = new Table();
    let tableWrapper = document.getElementById("tableWrapper");
    test.setWrapper(tableWrapper);
    /* Enter the data */
    let axes = {
        x: ["Col1", "Col2", "Col3", "Col4", "Col5"],
        y: ["Row1", "Row2", "Row3"]
    };
    for (let i of axes.y) {
        test.addRow(i);
    }
    for (let i of axes.x) {
        test.addCol(i);
    }
    test.draw();
};
const domReady = (callBack) => {
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", callBack);
    }
    if (document.readyState === "interactive") {
        callBack();
    }
};
domReady(initDomState);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQW1CQSxNQUFNLEtBQUs7SUFBWDtRQUNFLE1BQUMsR0FBYSxFQUFFLENBQUM7UUFDakIsTUFBQyxHQUFhLEVBQUUsQ0FBQztRQUVqQixTQUFJLEdBQUc7WUFDTCxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFO1lBQ3JDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUU7U0FDdEMsQ0FBQztJQWtMSixDQUFDO0lBaExDLFlBQVk7SUFDTCxVQUFVLENBQUMsSUFBaUI7UUFDakMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNELFlBQVk7SUFDTCxJQUFJO1FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDakIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2xDLE9BQU87U0FDUjtRQUVELElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUM1QixZQUFZO1FBQ1osSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUNELFlBQVk7SUFDSixhQUFhO1FBQ25CLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDL0MsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFaEMsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxZQUFZO1FBQ3pELFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFOUIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsWUFBWTtRQUNuRCxRQUFRLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRTNCLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFDRCxZQUFZO0lBQ0osaUJBQWlCO1FBQ3ZCLElBQUksU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDaEQsSUFBSSxZQUFZLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoRCxJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLFlBQVksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFL0IsS0FBSyxJQUFJLE1BQU0sSUFBSSxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ3pCLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7WUFDNUIsWUFBWSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUMvQjtRQUVELFNBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0IsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUNELFlBQVk7SUFDSixjQUFjO1FBQ3BCLElBQUksWUFBWSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkQsS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1gsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWTtZQUMxRCxZQUFZLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ25DO1FBQ0QsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUNELFlBQVk7SUFDSixpQkFBaUIsQ0FBQyxRQUFnQjtRQUN4QyxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0IsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxXQUFXLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQztRQUNoQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRTNCLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRTtZQUNwQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNYLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxZQUFZO1lBQ3BFLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDN0I7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBQ0QsWUFBWTtJQUNKLGlCQUFpQixDQUFDLFFBQWdCLEVBQUUsUUFBZ0I7UUFDMUQsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0IsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDO1FBRXRCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVMsR0FBRztZQUMxQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFO1lBQzVDLFNBQVMsR0FBRyxJQUFJLENBQUM7U0FDbEI7UUFFRCxJQUFJLFFBQVEsR0FBZ0IsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1RCxRQUFRLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUUxQyxJQUFJLFNBQVMsRUFBRTtZQUNiLFFBQVEsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1NBQzdDO1FBRUQsSUFBSSxZQUFZLEdBQUcsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQztRQUM5RCxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3pELE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFekIsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUNELFlBQVk7SUFDSixVQUFVO1FBQ2hCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsRUFBRTtnQkFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7b0JBQ2pCLE9BQU87aUJBQ1I7Z0JBRUQsSUFBSSxRQUFRLEdBQXFCLEtBQUssQ0FBQyxNQUFNLENBQUM7Z0JBQzlDLE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO2dCQUUvQyxZQUFZO2dCQUNaLElBQUksQ0FBQyxZQUFZLEVBQUU7b0JBQ2pCLE9BQU87aUJBQ1I7Z0JBRUQsTUFBTSxJQUFJLEdBQTJDLElBQUksQ0FBQyxLQUFLLENBQzdELFlBQVksQ0FDYixJQUFJO29CQUNILFFBQVEsRUFBRSxDQUFDLENBQUM7b0JBQ1osUUFBUSxFQUFFLENBQUMsQ0FBQztpQkFDYixDQUFDO2dCQUNGLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7Z0JBQzdCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQzdELGVBQWU7WUFDakIsQ0FBQyxDQUFDLENBQUM7U0FDSjtJQUNILENBQUM7SUFDRCxZQUFZO0lBQ0osa0JBQWtCLENBQ3hCLFFBQWdCLEVBQ2hCLFFBQWdCLEVBQ2hCLEtBQWM7UUFFZCxJQUFJLE9BQU8sR0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksT0FBTyxHQUFXLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdkMsSUFBSSxRQUFRLEdBQWEsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQ2xFLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELGFBQWE7SUFDTCxXQUFXLENBQUMsUUFBa0I7UUFDcEMsSUFBSSxLQUFLLEdBQWtCLElBQUksQ0FBQztRQUVoQyxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDdkIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLEVBQUU7Z0JBQ2hFLEtBQUssR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDckI7U0FDRjtRQUVELElBQUksS0FBSyxLQUFLLElBQUksRUFBRTtZQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVEsQ0FBQztTQUM3QjthQUFNO1lBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDMUI7SUFDSCxDQUFDO0lBQ0QsYUFBYTtJQUNOLE1BQU0sQ0FBQyxPQUFlO1FBQzNCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFDTSxNQUFNLENBQUMsT0FBZTtRQUMzQixJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBQ0Qsb0NBQW9DO0lBQzdCLFdBQVc7UUFDaEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzlCLDBEQUEwRDtRQUMxRCwwQkFBMEI7UUFDMUIsdUJBQXVCO1FBQ3ZCLDBEQUEwRDtRQUMxRCwwQkFBMEI7UUFDMUIsdUJBQXVCO1FBQ3ZCLDBEQUEwRDtRQUMxRCxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0NBQ0Y7QUFFRCxNQUFNLFlBQVksR0FBRyxHQUFHLEVBQUU7SUFDeEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUN2QixJQUFJLFlBQVksR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzNELElBQUksQ0FBQyxVQUFVLENBQUMsWUFBMkIsQ0FBQyxDQUFDO0lBQzdDLG9CQUFvQjtJQUNwQixJQUFJLElBQUksR0FBRztRQUNULENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFDM0MsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7S0FDNUIsQ0FBQztJQUVGLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRTtRQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2hCO0lBQ0QsS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxFQUFFO1FBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDaEI7SUFFRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDZCxDQUFDLENBQUM7QUFFRixNQUFNLFFBQVEsR0FBRyxDQUFDLFFBQW9CLEVBQUUsRUFBRTtJQUN4QyxJQUFJLFFBQVEsQ0FBQyxVQUFVLEtBQUssU0FBUyxFQUFFO1FBQ3JDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxRQUFRLENBQUMsQ0FBQztLQUN6RDtJQUNELElBQUksUUFBUSxDQUFDLFVBQVUsS0FBSyxhQUFhLEVBQUU7UUFDekMsUUFBUSxFQUFFLENBQUM7S0FDWjtBQUNILENBQUMsQ0FBQztBQUVGLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIFRhYmxlSW50ZXJmYWNlIHtcbiAgeDogc3RyaW5nW107XG4gIHk6IHN0cmluZ1tdO1xuICB3cmFwcGVyOiBIVE1MRWxlbWVudDtcbiAgZGF0YTogRGF0YVBhaXJbXTtcblxuICBzZXRXcmFwcGVyKHdyYXA6IEhUTUxFbGVtZW50KTogSFRNTEVsZW1lbnQ7XG4gIGRyYXcoKTogdm9pZDtcbiAgYWRkUm93KHJvd05hbWU6IHN0cmluZyk6IHZvaWQ7XG4gIGFkZENvbChjb2xOYW1lOiBzdHJpbmcpOiB2b2lkO1xuICBsb2dnaW5nRGF0YSgpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgRGF0YVBhaXIge1xuICB4OiBzdHJpbmc7XG4gIHk6IHN0cmluZztcbiAgdmFsdWU6IGJvb2xlYW47XG59XG5cbmNsYXNzIFRhYmxlIGltcGxlbWVudHMgVGFibGVJbnRlcmZhY2Uge1xuICB4OiBzdHJpbmdbXSA9IFtdO1xuICB5OiBzdHJpbmdbXSA9IFtdO1xuICB3cmFwcGVyOiBIVE1MRWxlbWVudDtcbiAgZGF0YSA9IFtcbiAgICB7IHg6IFwiQ29sMVwiLCB5OiBcIlJvdzFcIiwgdmFsdWU6IHRydWUgfSxcbiAgICB7IHg6IFwiQ29sMlwiLCB5OiBcIlJvdzNcIiwgdmFsdWU6IHRydWUgfVxuICBdO1xuXG4gIC8qIFN0ZXAgMSAqL1xuICBwdWJsaWMgc2V0V3JhcHBlcih3cmFwOiBIVE1MRWxlbWVudCk6IEhUTUxFbGVtZW50IHtcbiAgICByZXR1cm4gKHRoaXMud3JhcHBlciA9IHdyYXApO1xuICB9XG4gIC8qIFN0ZXAgMiAqL1xuICBwdWJsaWMgZHJhdygpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMud3JhcHBlcikge1xuICAgICAgY29uc29sZS5sb2coXCJFcnJvciEgTm8gd3JhcHBlciFcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy53cmFwcGVyLmlubmVySFRNTCA9IFwiXCI7XG4gICAgLyogU3RlcCAzICovXG4gICAgbGV0IHRhYmxlRG9tID0gdGhpcy5idWlsZFRhYmxlRG9tKCk7XG4gICAgdGhpcy53cmFwcGVyLmFwcGVuZCh0YWJsZURvbSk7XG4gICAgdGhpcy5pbml0RXZlbnRzKCk7XG4gICAgdGhpcy5sb2dnaW5nRGF0YSgpO1xuICB9XG4gIC8qIFN0ZXAgMyAqL1xuICBwcml2YXRlIGJ1aWxkVGFibGVEb20oKTogSFRNTEVsZW1lbnQge1xuICAgIGxldCB0YWJsZURvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcbiAgICB0YWJsZURvbS5jbGFzc0xpc3QuYWRkKFwidGFibGVcIik7XG5cbiAgICBsZXQgdGFibGVIZWFkZXJzID0gdGhpcy5idWlsZFRhYmxlSGVhZGVycygpOyAvKiBTdGVwIDQgKi9cbiAgICB0YWJsZURvbS5hcHBlbmQodGFibGVIZWFkZXJzKTtcblxuICAgIGxldCB0YWJsZUJvZHkgPSB0aGlzLmJ1aWxkVGFibGVCb2R5KCk7IC8qIFN0ZXAgNSAqL1xuICAgIHRhYmxlRG9tLmFwcGVuZCh0YWJsZUJvZHkpO1xuXG4gICAgcmV0dXJuIHRhYmxlRG9tO1xuICB9XG4gIC8qIFN0ZXAgNCAqL1xuICBwcml2YXRlIGJ1aWxkVGFibGVIZWFkZXJzKCk6IEhUTUxFbGVtZW50IHtcbiAgICBsZXQgdGFibGVIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoZWFkXCIpO1xuICAgIGxldCB0YWJsZUhlYWRSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG4gICAgbGV0IGVtcHR5Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcbiAgICB0YWJsZUhlYWRSb3cuYXBwZW5kKGVtcHR5Q2VsbCk7XG5cbiAgICBmb3IgKGxldCB0aE5hbWUgb2YgdGhpcy54KSB7XG4gICAgICBsZXQgaGVhZENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIik7XG4gICAgICBoZWFkQ2VsbC5pbm5lckhUTUwgPSB0aE5hbWU7XG4gICAgICB0YWJsZUhlYWRSb3cuYXBwZW5kKGhlYWRDZWxsKTtcbiAgICB9XG5cbiAgICB0YWJsZUhlYWQuYXBwZW5kKHRhYmxlSGVhZFJvdyk7XG4gICAgcmV0dXJuIHRhYmxlSGVhZDtcbiAgfVxuICAvKiBTdGVwIDUgKi9cbiAgcHJpdmF0ZSBidWlsZFRhYmxlQm9keSgpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IHRhYmxlQm9keURvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0Ym9keVwiKTtcbiAgICBmb3IgKGxldCBpIGluIHRoaXMueSkge1xuICAgICAgbGV0IHkgPSAraTtcbiAgICAgIGxldCB0YWJsZUJvZHlSb3cgPSB0aGlzLmJ1aWxkVGFibGVCb2R5Um93KHkpOyAvKiBTdGVwIDYgKi9cbiAgICAgIHRhYmxlQm9keURvbS5hcHBlbmQodGFibGVCb2R5Um93KTtcbiAgICB9XG4gICAgcmV0dXJuIHRhYmxlQm9keURvbTtcbiAgfVxuICAvKiBTdGVwIDYgKi9cbiAgcHJpdmF0ZSBidWlsZFRhYmxlQm9keVJvdyhyb3dJbmRleDogbnVtYmVyKTogSFRNTEVsZW1lbnQge1xuICAgIGxldCByb3dEb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XG4gICAgbGV0IHJvd05hbWUgPSB0aGlzLnlbcm93SW5kZXhdO1xuICAgIGxldCByb3dOYW1lQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcbiAgICByb3dOYW1lQ2VsbC5pbm5lckhUTUwgPSByb3dOYW1lO1xuICAgIHJvd0RvbS5hcHBlbmQocm93TmFtZUNlbGwpO1xuXG4gICAgZm9yIChsZXQgaSBpbiB0aGlzLngpIHtcbiAgICAgIGxldCB5ID0gK2k7XG4gICAgICBsZXQgdGFibGVDZWxsRG9tID0gdGhpcy5idWlsZFRhYmxlQ2VsbERvbSh5LCByb3dJbmRleCk7IC8qIFN0ZXAgNyAqL1xuICAgICAgcm93RG9tLmFwcGVuZCh0YWJsZUNlbGxEb20pO1xuICAgIH1cbiAgICByZXR1cm4gcm93RG9tO1xuICB9XG4gIC8qIFN0ZXAgNyAqL1xuICBwcml2YXRlIGJ1aWxkVGFibGVDZWxsRG9tKGNvbEluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpOiBIVE1MRWxlbWVudCB7XG4gICAgbGV0IGNlbGxEb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XG4gICAgbGV0IHJvd05hbWUgPSB0aGlzLnlbcm93SW5kZXhdO1xuICAgIGxldCBjb2xOYW1lID0gdGhpcy54W2NvbEluZGV4XTtcbiAgICBsZXQgY2VsbFZhbHVlID0gZmFsc2U7XG5cbiAgICBsZXQgZGF0YVBhaXIgPSB0aGlzLmRhdGEuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIG9iai54ID09IGNvbE5hbWUgJiYgb2JqLnkgPT0gcm93TmFtZTtcbiAgICB9KTtcblxuICAgIGlmIChkYXRhUGFpci5sZW5ndGggPiAwICYmIGRhdGFQYWlyWzBdLnZhbHVlKSB7XG4gICAgICBjZWxsVmFsdWUgPSB0cnVlO1xuICAgIH1cblxuICAgIGxldCBjaGVja0JveDogSFRNTEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gICAgY2hlY2tCb3guc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImNoZWNrYm94XCIpO1xuXG4gICAgaWYgKGNlbGxWYWx1ZSkge1xuICAgICAgY2hlY2tCb3guc2V0QXR0cmlidXRlKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG4gICAgfVxuXG4gICAgbGV0IGNoZWNrQm94RGF0YSA9IHsgY29sSW5kZXg6IGNvbEluZGV4LCByb3dJbmRleDogcm93SW5kZXggfTtcbiAgICBjaGVja0JveC5kYXRhc2V0LnBvc2l0aW9uID0gSlNPTi5zdHJpbmdpZnkoY2hlY2tCb3hEYXRhKTtcbiAgICBjZWxsRG9tLmFwcGVuZChjaGVja0JveCk7XG5cbiAgICByZXR1cm4gY2VsbERvbTtcbiAgfVxuICAvKiBTdGVwIDggKi9cbiAgcHJpdmF0ZSBpbml0RXZlbnRzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLndyYXBwZXIpIHtcbiAgICAgIHRoaXMud3JhcHBlci5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKCFldmVudC50YXJnZXQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgY2hlY2tCb3ggPSA8SFRNTElucHV0RWxlbWVudD5ldmVudC50YXJnZXQ7XG4gICAgICAgIGNvbnN0IGNoZWNrQm94RGF0YSA9IGNoZWNrQm94LmRhdGFzZXQucG9zaXRpb247XG5cbiAgICAgICAgLyogU3RlcCA5ICovXG4gICAgICAgIGlmICghY2hlY2tCb3hEYXRhKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGF0YTogeyBjb2xJbmRleDogbnVtYmVyOyByb3dJbmRleDogbnVtYmVyIH0gPSBKU09OLnBhcnNlKFxuICAgICAgICAgIGNoZWNrQm94RGF0YVxuICAgICAgICApIHx8IHtcbiAgICAgICAgICBjb2xJbmRleDogLTEsXG4gICAgICAgICAgcm93SW5kZXg6IC0xXG4gICAgICAgIH07XG4gICAgICAgIGxldCB2YWx1ZSA9IGNoZWNrQm94LmNoZWNrZWQ7XG4gICAgICAgIHRoaXMuYWRkRGF0YVBhaXJCeUluZGV4KGRhdGEucm93SW5kZXgsIGRhdGEuY29sSW5kZXgsIHZhbHVlKTtcbiAgICAgICAgLy8gdGhpcy5kcmF3KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgLyogU3RlcCA5ICovXG4gIHByaXZhdGUgYWRkRGF0YVBhaXJCeUluZGV4KFxuICAgIHJvd0luZGV4OiBudW1iZXIsXG4gICAgY29sSW5kZXg6IG51bWJlcixcbiAgICB2YWx1ZTogYm9vbGVhblxuICApOiB2b2lkIHtcbiAgICBsZXQgY29sTmFtZTogc3RyaW5nID0gdGhpcy54W2NvbEluZGV4XTtcbiAgICBsZXQgcm93TmFtZTogc3RyaW5nID0gdGhpcy55W3Jvd0luZGV4XTtcbiAgICBsZXQgZGF0YVBhaXI6IERhdGFQYWlyID0geyB4OiBjb2xOYW1lLCB5OiByb3dOYW1lLCB2YWx1ZTogdmFsdWUgfTtcbiAgICB0aGlzLmFkZERhdGFQYWlyKGRhdGFQYWlyKTtcbiAgfVxuICAvKiBTdGVwIDEwICovXG4gIHByaXZhdGUgYWRkRGF0YVBhaXIoZGF0YVBhaXI6IERhdGFQYWlyKTogdm9pZCB7XG4gICAgbGV0IGluZGV4OiBudWxsIHwgbnVtYmVyID0gbnVsbDtcblxuICAgIGZvciAobGV0IGkgaW4gdGhpcy5kYXRhKSB7XG4gICAgICBpZiAodGhpcy5kYXRhW2ldLnggPT0gZGF0YVBhaXIueCAmJiB0aGlzLmRhdGFbaV0ueSA9PSBkYXRhUGFpci55KSB7XG4gICAgICAgIGluZGV4ID0gcGFyc2VJbnQoaSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGluZGV4ICE9PSBudWxsKSB7XG4gICAgICB0aGlzLmRhdGFbaW5kZXhdID0gZGF0YVBhaXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGF0YS5wdXNoKGRhdGFQYWlyKTtcbiAgICB9XG4gIH1cbiAgLyogU3RlcCAxMSAqL1xuICBwdWJsaWMgYWRkUm93KHJvd05hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMueS5wdXNoKHJvd05hbWUpO1xuICB9XG4gIHB1YmxpYyBhZGRDb2woY29sTmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy54LnB1c2goY29sTmFtZSk7XG4gIH1cbiAgLyogU3RlcCAxMiAoRm9yIGNvbnNvbGUgbG9nIGRhdGEpICovXG4gIHB1YmxpYyBsb2dnaW5nRGF0YSgpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhcIkRhdGEgbG9nZ2luZzogXCIpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiQXJyYXkgeFwiKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLngpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiQXJyYXkgeVwiKTtcbiAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnkpO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgIGNvbnNvbGUubG9nKFwiQXJyYXkgZGF0YVwiKTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEpO1xuICAgIGNvbnNvbGUubG9nKFwiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXCIpO1xuICB9XG59XG5cbmNvbnN0IGluaXREb21TdGF0ZSA9ICgpID0+IHtcbiAgbGV0IHRlc3QgPSBuZXcgVGFibGUoKTtcbiAgbGV0IHRhYmxlV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGFibGVXcmFwcGVyXCIpO1xuICB0ZXN0LnNldFdyYXBwZXIodGFibGVXcmFwcGVyIGFzIEhUTUxFbGVtZW50KTtcbiAgLyogRW50ZXIgdGhlIGRhdGEgKi9cbiAgbGV0IGF4ZXMgPSB7XG4gICAgeDogW1wiQ29sMVwiLCBcIkNvbDJcIiwgXCJDb2wzXCIsIFwiQ29sNFwiLCBcIkNvbDVcIl0sXG4gICAgeTogW1wiUm93MVwiLCBcIlJvdzJcIiwgXCJSb3czXCJdXG4gIH07XG5cbiAgZm9yIChsZXQgaSBvZiBheGVzLnkpIHtcbiAgICB0ZXN0LmFkZFJvdyhpKTtcbiAgfVxuICBmb3IgKGxldCBpIG9mIGF4ZXMueCkge1xuICAgIHRlc3QuYWRkQ29sKGkpO1xuICB9XG5cbiAgdGVzdC5kcmF3KCk7XG59O1xuXG5jb25zdCBkb21SZWFkeSA9IChjYWxsQmFjazogKCkgPT4gdm9pZCkgPT4ge1xuICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJsb2FkaW5nXCIpIHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBjYWxsQmFjayk7XG4gIH1cbiAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwiaW50ZXJhY3RpdmVcIikge1xuICAgIGNhbGxCYWNrKCk7XG4gIH1cbn07XG5cbmRvbVJlYWR5KGluaXREb21TdGF0ZSk7XG4iXX0=
