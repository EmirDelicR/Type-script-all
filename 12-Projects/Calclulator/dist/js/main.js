"use strict";
const setupData = [
    { class: "on-off", row: 1, value: "C" },
    { class: "mc", row: 1, value: "mc" },
    { class: "num7", row: 2, value: "7" },
    { class: "num8", row: 2, value: "8" },
    { class: "num9", row: 2, value: "9" },
    { class: "divide", row: 2, value: "/" },
    { class: "num4", row: 3, value: "4" },
    { class: "num5", row: 3, value: "5" },
    { class: "num6", row: 3, value: "6" },
    { class: "multi", row: 3, value: "*" },
    { class: "num1", row: 4, value: "1" },
    { class: "num2", row: 4, value: "2" },
    { class: "num3", row: 4, value: "3" },
    { class: "minus", row: 4, value: "-" },
    { class: "num0", row: 5, value: "0" },
    { class: "dot", row: 5, value: "." },
    { class: "eql", row: 5, value: "=" },
    { class: "plus", row: 5, value: "+" }
];
class Calculator {
    constructor() {
        this.data = setupData;
        this.previousRowNum = 0;
        this.buttonsInnerValue = [];
        this.status = false;
        const displayElement = document.getElementById("display");
        const wrapperElement = document.getElementById("calcBody");
        if (displayElement) {
            this.display = displayElement;
        }
        if (wrapperElement) {
            this.wrapper = wrapperElement;
        }
    }
    buildButton(element) {
        let button = document.createElement("button");
        button.setAttribute("class", `btn ${element.class}`);
        button.innerHTML = element.value;
        return button;
    }
    draw() {
        let row = document.createElement("row");
        row.setAttribute("class", `row-${this.previousRowNum}`);
        let rowCheck = false;
        this.data.forEach(element => {
            rowCheck = this.checkRowNumber(element.row, this.previousRowNum);
            if (rowCheck) {
                row = document.createElement("div");
                row.setAttribute("class", `row-${element.row}`);
                this.wrapper.append(row);
            }
            let btn = this.buildButton(element);
            row.append(btn);
        });
    }
    checkRowNumber(currentRowNum, previousRowNum) {
        if (currentRowNum !== previousRowNum) {
            this.previousRowNum = currentRowNum;
            return true;
        }
        return false;
    }
    populateArray(button) {
        let val = button.innerText;
        switch (val) {
            case "=":
                this.calculateResult();
                break;
            case "C":
                this.turnOnOff();
                break;
            case "mc":
                this.clear();
                break;
            default:
                if (this.buttonsInnerValue.length < 10 && this.status) {
                    this.buttonsInnerValue.push(val);
                    this.displayValues();
                }
        }
    }
    displayValues() {
        this.display.innerHTML = "";
        let content = "";
        this.buttonsInnerValue.forEach(elem => {
            content = `${content}${elem} `;
        });
        this.display.innerHTML = content;
    }
    displayResult(val) {
        this.clear();
        this.display.innerHTML = `${val}`;
    }
    turnOnOff() {
        this.status = !this.status;
        const displayClassList = this.display.classList;
        if (displayClassList.contains("off")) {
            displayClassList.remove("off");
            displayClassList.add("on");
        }
        else {
            displayClassList.remove("on");
            displayClassList.add("off");
        }
        this.clear();
    }
    clear() {
        this.display.classList.remove("error");
        this.display.innerHTML = "";
        this.buttonsInnerValue = [];
    }
    validateInput() {
        let lastChar = this.buttonsInnerValue[this.buttonsInnerValue.length - 1];
        if (!lastChar) {
            return null;
        }
        if (!lastChar.match(/^\d+$/)) {
            return false;
        }
        for (let i = 1; i < this.buttonsInnerValue.length; i++) {
            if (this.buttonsInnerValue[i].match(/[-\/*+.|[\]]/g) &&
                this.buttonsInnerValue[i - 1].match(/[-\/*+.|[\]]/g)) {
                return false;
            }
        }
        return true;
    }
    calculateResult() {
        let check = this.validateInput();
        console.log("check: ", check);
        if (check === null) {
            this.clear();
            return;
        }
        if (check) {
            let result = eval(this.buttonsInnerValue.join(""));
            this.displayResult(result);
            this.display.classList.remove("error");
            return;
        }
        this.display.classList.add("error");
    }
    build() {
        this.draw();
    }
}
const initDomState = () => {
    let calc = new Calculator();
    calc.build();
    let buttons = document.getElementsByClassName("btn");
    for (let button of buttons) {
        button.addEventListener("click", event => {
            calc.populateArray(button);
        });
    }
};
const domReady = (callBack) => {
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", callBack);
    }
    if (document.readyState === "interactive") {
        callBack();
    }
};
const windowReady = (callBack) => {
    if (document.readyState === "complete") {
        callBack();
        return;
    }
    window.addEventListener("load", callBack);
};
domReady(initDomState);
// windowReady(initDomState);

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QWdCLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ3ZDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBcUIsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLFFBQVEsR0FBRyxDQUFDLFFBQW9CLEVBQUUsRUFBRTtJQUN4QyxJQUFJLFFBQVEsQ0FBQyxVQUFVLEtBQUssU0FBUyxFQUFFO1FBQ3JDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxRQUFRLENBQUMsQ0FBQztLQUN6RDtJQUNELElBQUksUUFBUSxDQUFDLFVBQVUsS0FBSyxhQUFhLEVBQUU7UUFDekMsUUFBUSxFQUFFLENBQUM7S0FDWjtBQUNILENBQUMsQ0FBQztBQUVGLE1BQU0sV0FBVyxHQUFHLENBQUMsUUFBb0IsRUFBRSxFQUFFO0lBQzNDLElBQUksUUFBUSxDQUFDLFVBQVUsS0FBSyxVQUFVLEVBQUU7UUFDdEMsUUFBUSxFQUFFLENBQUM7UUFDWCxPQUFPO0tBQ1I7SUFDRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUMsQ0FBQztBQUVGLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2Qiw2QkFBNkIiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNldHVwRGF0YSA9IFtcbiAgeyBjbGFzczogXCJvbi1vZmZcIiwgcm93OiAxLCB2YWx1ZTogXCJDXCIgfSxcbiAgeyBjbGFzczogXCJtY1wiLCByb3c6IDEsIHZhbHVlOiBcIm1jXCIgfSxcbiAgeyBjbGFzczogXCJudW03XCIsIHJvdzogMiwgdmFsdWU6IFwiN1wiIH0sXG4gIHsgY2xhc3M6IFwibnVtOFwiLCByb3c6IDIsIHZhbHVlOiBcIjhcIiB9LFxuICB7IGNsYXNzOiBcIm51bTlcIiwgcm93OiAyLCB2YWx1ZTogXCI5XCIgfSxcbiAgeyBjbGFzczogXCJkaXZpZGVcIiwgcm93OiAyLCB2YWx1ZTogXCIvXCIgfSxcbiAgeyBjbGFzczogXCJudW00XCIsIHJvdzogMywgdmFsdWU6IFwiNFwiIH0sXG4gIHsgY2xhc3M6IFwibnVtNVwiLCByb3c6IDMsIHZhbHVlOiBcIjVcIiB9LFxuICB7IGNsYXNzOiBcIm51bTZcIiwgcm93OiAzLCB2YWx1ZTogXCI2XCIgfSxcbiAgeyBjbGFzczogXCJtdWx0aVwiLCByb3c6IDMsIHZhbHVlOiBcIipcIiB9LFxuICB7IGNsYXNzOiBcIm51bTFcIiwgcm93OiA0LCB2YWx1ZTogXCIxXCIgfSxcbiAgeyBjbGFzczogXCJudW0yXCIsIHJvdzogNCwgdmFsdWU6IFwiMlwiIH0sXG4gIHsgY2xhc3M6IFwibnVtM1wiLCByb3c6IDQsIHZhbHVlOiBcIjNcIiB9LFxuICB7IGNsYXNzOiBcIm1pbnVzXCIsIHJvdzogNCwgdmFsdWU6IFwiLVwiIH0sXG4gIHsgY2xhc3M6IFwibnVtMFwiLCByb3c6IDUsIHZhbHVlOiBcIjBcIiB9LFxuICB7IGNsYXNzOiBcImRvdFwiLCByb3c6IDUsIHZhbHVlOiBcIi5cIiB9LFxuICB7IGNsYXNzOiBcImVxbFwiLCByb3c6IDUsIHZhbHVlOiBcIj1cIiB9LFxuICB7IGNsYXNzOiBcInBsdXNcIiwgcm93OiA1LCB2YWx1ZTogXCIrXCIgfVxuXTtcblxuaW50ZXJmYWNlIENhbGN1bGF0b3JJbnRlcmZhY2Uge1xuICBkYXRhOiBSb3dFbGVtZW50W107XG4gIHByZXZpb3VzUm93TnVtOiBudW1iZXI7XG4gIGJ1dHRvbnNJbm5lclZhbHVlOiBzdHJpbmdbXTtcbiAgc3RhdHVzOiBib29sZWFuO1xuICBkaXNwbGF5OiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZDtcbiAgd3JhcHBlcjogSFRNTEVsZW1lbnQgfCB1bmRlZmluZWQ7XG59XG5cbmludGVyZmFjZSBSb3dFbGVtZW50IHtcbiAgY2xhc3M6IHN0cmluZztcbiAgcm93OiBudW1iZXI7XG4gIHZhbHVlOiBzdHJpbmc7XG59XG5cbmNsYXNzIENhbGN1bGF0b3IgaW1wbGVtZW50cyBDYWxjdWxhdG9ySW50ZXJmYWNlIHtcbiAgZGF0YTogUm93RWxlbWVudFtdID0gc2V0dXBEYXRhO1xuICBwcmV2aW91c1Jvd051bTogbnVtYmVyID0gMDtcbiAgYnV0dG9uc0lubmVyVmFsdWU6IHN0cmluZ1tdID0gW107XG4gIHN0YXR1czogYm9vbGVhbiA9IGZhbHNlO1xuICBkaXNwbGF5OiBIVE1MRWxlbWVudDtcbiAgd3JhcHBlcjogSFRNTEVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc3QgZGlzcGxheUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpc3BsYXlcIik7XG4gICAgY29uc3Qgd3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbGNCb2R5XCIpO1xuICAgIGlmIChkaXNwbGF5RWxlbWVudCkge1xuICAgICAgdGhpcy5kaXNwbGF5ID0gZGlzcGxheUVsZW1lbnQ7XG4gICAgfVxuICAgIGlmICh3cmFwcGVyRWxlbWVudCkge1xuICAgICAgdGhpcy53cmFwcGVyID0gd3JhcHBlckVsZW1lbnQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZEJ1dHRvbihlbGVtZW50OiBSb3dFbGVtZW50KSB7XG4gICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGBidG4gJHtlbGVtZW50LmNsYXNzfWApO1xuICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBlbGVtZW50LnZhbHVlO1xuICAgIHJldHVybiBidXR0b247XG4gIH1cblxuICBwcml2YXRlIGRyYXcoKSB7XG4gICAgbGV0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJyb3dcIik7XG4gICAgcm93LnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGByb3ctJHt0aGlzLnByZXZpb3VzUm93TnVtfWApO1xuICAgIGxldCByb3dDaGVjayA9IGZhbHNlO1xuXG4gICAgdGhpcy5kYXRhLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICByb3dDaGVjayA9IHRoaXMuY2hlY2tSb3dOdW1iZXIoZWxlbWVudC5yb3csIHRoaXMucHJldmlvdXNSb3dOdW0pO1xuICAgICAgaWYgKHJvd0NoZWNrKSB7XG4gICAgICAgIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHJvdy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBgcm93LSR7ZWxlbWVudC5yb3d9YCk7XG4gICAgICAgIHRoaXMud3JhcHBlci5hcHBlbmQocm93KTtcbiAgICAgIH1cbiAgICAgIGxldCBidG4gPSB0aGlzLmJ1aWxkQnV0dG9uKGVsZW1lbnQpO1xuICAgICAgcm93LmFwcGVuZChidG4pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1Jvd051bWJlcihjdXJyZW50Um93TnVtOiBudW1iZXIsIHByZXZpb3VzUm93TnVtOiBudW1iZXIpIHtcbiAgICBpZiAoY3VycmVudFJvd051bSAhPT0gcHJldmlvdXNSb3dOdW0pIHtcbiAgICAgIHRoaXMucHJldmlvdXNSb3dOdW0gPSBjdXJyZW50Um93TnVtO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBwb3B1bGF0ZUFycmF5KGJ1dHRvbjogSFRNTEVsZW1lbnQpIHtcbiAgICBsZXQgdmFsID0gYnV0dG9uLmlubmVyVGV4dDtcbiAgICBzd2l0Y2ggKHZhbCkge1xuICAgICAgY2FzZSBcIj1cIjpcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVSZXN1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiQ1wiOlxuICAgICAgICB0aGlzLnR1cm5Pbk9mZigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtY1wiOlxuICAgICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKHRoaXMuYnV0dG9uc0lubmVyVmFsdWUubGVuZ3RoIDwgMTAgJiYgdGhpcy5zdGF0dXMpIHtcbiAgICAgICAgICB0aGlzLmJ1dHRvbnNJbm5lclZhbHVlLnB1c2godmFsKTtcbiAgICAgICAgICB0aGlzLmRpc3BsYXlWYWx1ZXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZGlzcGxheVZhbHVlcygpIHtcbiAgICB0aGlzLmRpc3BsYXkuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBsZXQgY29udGVudCA9IFwiXCI7XG4gICAgdGhpcy5idXR0b25zSW5uZXJWYWx1ZS5mb3JFYWNoKGVsZW0gPT4ge1xuICAgICAgY29udGVudCA9IGAke2NvbnRlbnR9JHtlbGVtfSBgO1xuICAgIH0pO1xuICAgIHRoaXMuZGlzcGxheS5pbm5lckhUTUwgPSBjb250ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5UmVzdWx0KHZhbDogbnVtYmVyKSB7XG4gICAgdGhpcy5jbGVhcigpO1xuICAgIHRoaXMuZGlzcGxheS5pbm5lckhUTUwgPSBgJHt2YWx9YDtcbiAgfVxuXG4gIHByaXZhdGUgdHVybk9uT2ZmKCkge1xuICAgIHRoaXMuc3RhdHVzID0gIXRoaXMuc3RhdHVzO1xuICAgIGNvbnN0IGRpc3BsYXlDbGFzc0xpc3QgPSB0aGlzLmRpc3BsYXkuY2xhc3NMaXN0O1xuXG4gICAgaWYgKGRpc3BsYXlDbGFzc0xpc3QuY29udGFpbnMoXCJvZmZcIikpIHtcbiAgICAgIGRpc3BsYXlDbGFzc0xpc3QucmVtb3ZlKFwib2ZmXCIpO1xuICAgICAgZGlzcGxheUNsYXNzTGlzdC5hZGQoXCJvblwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlzcGxheUNsYXNzTGlzdC5yZW1vdmUoXCJvblwiKTtcbiAgICAgIGRpc3BsYXlDbGFzc0xpc3QuYWRkKFwib2ZmXCIpO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXIoKSB7XG4gICAgdGhpcy5kaXNwbGF5LmNsYXNzTGlzdC5yZW1vdmUoXCJlcnJvclwiKTtcbiAgICB0aGlzLmRpc3BsYXkuaW5uZXJIVE1MID0gXCJcIjtcbiAgICB0aGlzLmJ1dHRvbnNJbm5lclZhbHVlID0gW107XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlSW5wdXQoKSB7XG4gICAgbGV0IGxhc3RDaGFyID0gdGhpcy5idXR0b25zSW5uZXJWYWx1ZVt0aGlzLmJ1dHRvbnNJbm5lclZhbHVlLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKCFsYXN0Q2hhcikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKCFsYXN0Q2hhci5tYXRjaCgvXlxcZCskLykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuYnV0dG9uc0lubmVyVmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5idXR0b25zSW5uZXJWYWx1ZVtpXS5tYXRjaCgvWy1cXC8qKy58W1xcXV0vZykgJiZcbiAgICAgICAgdGhpcy5idXR0b25zSW5uZXJWYWx1ZVtpIC0gMV0ubWF0Y2goL1stXFwvKisufFtcXF1dL2cpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUmVzdWx0KCkge1xuICAgIGxldCBjaGVjayA9IHRoaXMudmFsaWRhdGVJbnB1dCgpO1xuICAgIGNvbnNvbGUubG9nKFwiY2hlY2s6IFwiLCBjaGVjayk7XG4gICAgaWYgKGNoZWNrID09PSBudWxsKSB7XG4gICAgICB0aGlzLmNsZWFyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNoZWNrKSB7XG4gICAgICBsZXQgcmVzdWx0ID0gZXZhbCh0aGlzLmJ1dHRvbnNJbm5lclZhbHVlLmpvaW4oXCJcIikpO1xuICAgICAgdGhpcy5kaXNwbGF5UmVzdWx0KHJlc3VsdCk7XG4gICAgICB0aGlzLmRpc3BsYXkuY2xhc3NMaXN0LnJlbW92ZShcImVycm9yXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZGlzcGxheS5jbGFzc0xpc3QuYWRkKFwiZXJyb3JcIik7XG4gIH1cblxuICBwdWJsaWMgYnVpbGQoKSB7XG4gICAgdGhpcy5kcmF3KCk7XG4gIH1cbn1cblxuY29uc3QgaW5pdERvbVN0YXRlID0gKCkgPT4ge1xuICBsZXQgY2FsYyA9IG5ldyBDYWxjdWxhdG9yKCk7XG4gIGNhbGMuYnVpbGQoKTtcbiAgbGV0IGJ1dHRvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiYnRuXCIpO1xuXG4gIGZvciAobGV0IGJ1dHRvbiBvZiBidXR0b25zKSB7XG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudCA9PiB7XG4gICAgICBjYWxjLnBvcHVsYXRlQXJyYXkoYnV0dG9uIGFzIEhUTUxFbGVtZW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuY29uc3QgZG9tUmVhZHkgPSAoY2FsbEJhY2s6ICgpID0+IHZvaWQpID0+IHtcbiAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwibG9hZGluZ1wiKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgY2FsbEJhY2spO1xuICB9XG4gIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImludGVyYWN0aXZlXCIpIHtcbiAgICBjYWxsQmFjaygpO1xuICB9XG59O1xuXG5jb25zdCB3aW5kb3dSZWFkeSA9IChjYWxsQmFjazogKCkgPT4gdm9pZCkgPT4ge1xuICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgY2FsbEJhY2soKTtcbiAgICByZXR1cm47XG4gIH1cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGNhbGxCYWNrKTtcbn07XG5cbmRvbVJlYWR5KGluaXREb21TdGF0ZSk7XG4vLyB3aW5kb3dSZWFkeShpbml0RG9tU3RhdGUpO1xuIl19
